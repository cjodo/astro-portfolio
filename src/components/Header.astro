---
import ThemePicker from "@/components/ThemePicker.astro"

const { isHome, themePicker } = Astro.props

// Check if user is authenticated
const cookies = Astro.request.headers.get('cookie') || '';
const isAuthenticated = cookies.includes('auth=true');

interface Props {
	isHome?: boolean;
	themePicker: boolean
}
---

<header
	id="site-header"
	class=`
fixed top-0 left-0
w-full z-50
backdrop-blur-md text-secondary
transition-colors duration-300`
>
	<div class="mx-auto max-w-7xl px-4 sm:px-6 py-4 flex items-center justify-between">
		<a href="/" class="transition-all duration-200 hover:text-accent hover:scale-105 active:scale-95"><span class="font-semibold tracking-tight text-xl">[cjodo.dev]</span></a>

		<!-- Desktop Navigation -->
		<div class="hidden md:flex align-vertical justify-center gap-6 items-center">
			<nav class="flex gap-6 text-lg font-bold">
				<a href="/#projects" class="transition-all duration-200 hover:text-accent hover:scale-105 active:scale-95">Projects</a>
				<a href="/#about" class="transition-all duration-200 hover:text-accent hover:scale-105 active:scale-95">About</a>
				<a href="/#contact" class="transition-all duration-200 hover:text-accent hover:scale-105 active:scale-95">Contact</a>
				<a href="/blog" class="transition-all duration-200 hover:text-accent hover:scale-105 active:scale-95">Blog</a>
				{isAuthenticated && (
				<a href="/admin/dashboard" class="transition-all duration-200 hover:text-green-600 dark:hover:text-green-400 hover:scale-105 active:scale-95">Admin</a>
				)}
			</nav>
			{ themePicker && (
			<ThemePicker />
			) }
		</div>

		<!-- Mobile Menu Button -->
		<button
			id="mobile-menu-button"
			class="md:hidden p-2 rounded-lg hover:bg-tertiary active:bg-secondary cursor-pointer transition-all duration-200"
			aria-label="Toggle mobile menu"
		>
			<svg
				id="hamburger-icon"
				class="w-6 h-6 transition-transform duration-300"
				fill="none"
				stroke="currentColor"
				viewBox="0 0 24 24"
			>
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					stroke-width="2"
					d="M4 6h16M4 12h16M4 18h16"
				/>
			</svg>
			<svg
				id="close-icon"
				class="w-6 h-6 hidden transition-transform duration-300"
				fill="none"
				stroke="currentColor"
				viewBox="0 0 24 24"
			>
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					stroke-width="2"
					d="M6 18L18 6M6 6l12 12"
				/>
			</svg>
		</button>
	</div>

		<!-- Mobile Menu -->
	<div
		id="mobile-menu"
		class="md:hidden absolute top-full left-0 w-full bg-primary backdrop-blur-md shadow-lg transform -translate-y-full opacity-0 pointer-events-none transition-all duration-300 ease-in-out"
	>
		<nav class="flex flex-col p-4 space-y-3">
			<a href="/#projects" class="mobile-nav-link text-lg font-medium py-2 px-4 rounded-lg hover:bg-tertiary hover:text-accent hover:translate-x-1 active:bg-secondary transition-all duration-200">Projects</a>
			<a href="/#about" class="mobile-nav-link text-lg font-medium py-2 px-4 rounded-lg hover:bg-tertiary hover:text-accent hover:translate-x-1 active:bg-secondary transition-all duration-200">About</a>
			<a href="/#contact" class="mobile-nav-link text-lg font-medium py-2 px-4 rounded-lg hover:bg-tertiary hover:text-accent hover:translate-x-1 active:bg-secondary transition-all duration-200">Contact</a>
			<a href="/blog" class="mobile-nav-link text-lg font-medium py-2 px-4 rounded-lg hover:bg-tertiary hover:text-accent hover:translate-x-1 active:bg-secondary transition-all duration-200">Blog</a>
			{isAuthenticated && (
			<a href="/admin/dashboard" class="mobile-nav-link text-lg font-medium py-2 px-4 rounded-lg hover:bg-tertiary hover:text-green-600 hover:translate-x-1 active:bg-secondary transition-all duration-200">Admin</a>
			)}
			{ themePicker && (
			<div class="py-2 px-4">
				<ThemePicker />
			</div>
			) }
		</nav>
	</div>
</header>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const mobileMenuButton = document.getElementById('mobile-menu-button');
		const mobileMenu = document.getElementById('mobile-menu');
		const hamburgerIcon = document.getElementById('hamburger-icon');
		const closeIcon = document.getElementById('close-icon');
		const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

		if (!mobileMenuButton || !mobileMenu || !hamburgerIcon || !closeIcon) return;

		function toggleMobileMenu() {
			const isOpen = !mobileMenu.classList.contains('-translate-y-full');
			
			if (isOpen) {
				// Close menu
				mobileMenu.classList.add('-translate-y-full', 'opacity-0', 'pointer-events-none');
				mobileMenu.classList.remove('translate-y-0', 'opacity-100', 'pointer-events-auto');
				hamburgerIcon.classList.remove('hidden');
				closeIcon.classList.add('hidden');
				document.body.style.overflow = '';
			} else {
				// Open menu
				mobileMenu.classList.remove('-translate-y-full', 'opacity-0', 'pointer-events-none');
				mobileMenu.classList.add('translate-y-0', 'opacity-100', 'pointer-events-auto');
				hamburgerIcon.classList.add('hidden');
				closeIcon.classList.remove('hidden');
				document.body.style.overflow = 'hidden';
			}
		}

		mobileMenuButton.addEventListener('click', toggleMobileMenu);

		// Close menu when clicking on nav links
		mobileNavLinks.forEach(link => {
			link.addEventListener('click', () => {
				setTimeout(toggleMobileMenu, 150); // Small delay to allow navigation
			});
		});

		// Close menu when clicking outside
		document.addEventListener('click', (e) => {
			const target = e.target as Node;
			if (!mobileMenuButton.contains(target) && !mobileMenu.contains(target)) {
				const isOpen = !mobileMenu.classList.contains('-translate-y-full');
				if (isOpen) {
					toggleMobileMenu();
				}
			}
		});

		// Close menu on escape key
		document.addEventListener('keydown', (e) => {
			if (e.key === 'Escape') {
				const isOpen = !mobileMenu.classList.contains('-translate-y-full');
				if (isOpen) {
					toggleMobileMenu();
				}
			}
		});
	});
</script>

